<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"leetao50.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Nginx 架构从上边这张图，我们可以一览nginx的架构设计，首先我们可以直观得出nginx的几大特点：  事件驱动&amp;异步非阻塞 多进程机制 服务端缓存 反向代理  Nginx模块    核心模块 ：是nginx 服务器正常运行必不可少的模块，提供错误日志记录、配置文件解析、事件驱动机制、进程管理等核心功能 标准HTTP模块 ：提供 HTTP 协议解析相关的功能，如：端口配置、网页编码设">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx-配置">
<meta property="og:url" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="InfoPool">
<meta property="og:description" content="Nginx 架构从上边这张图，我们可以一览nginx的架构设计，首先我们可以直观得出nginx的几大特点：  事件驱动&amp;异步非阻塞 多进程机制 服务端缓存 反向代理  Nginx模块    核心模块 ：是nginx 服务器正常运行必不可少的模块，提供错误日志记录、配置文件解析、事件驱动机制、进程管理等核心功能 标准HTTP模块 ：提供 HTTP 协议解析相关的功能，如：端口配置、网页编码设">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/1131847985f79f1f463c35f3eb2ebb5ec2b5e8c3e97b41cdfe9233b2c06d5cf4.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/dcb9be47fd4ef765e7f7768f5cb9fe70c8cf416be6f139e49c80a19f6408c47f.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/906719353d4c09aff2cc5893b4f7268ea6c9212e6b2abe5e8029ad1c30606f5d.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/10a064ec18361b3d955e76e0ca66fd30f73116bb5b64f3fc94e68e99d9fccf3c.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/02ccd71b11335caae443ba0c6391dd9fe671526e6a630859838ed2f63b91273f.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/90b8227be27efbd64a2f46dd65b82a17719c01f4de358202c1b00c9fce4cfe5a.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/ba4dafbbf05c7421b7e3406341dc794a348f94c38224aa11be57060f7d728ebd.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/75505aff0f154ef619465c07e5ff92c4255343489c38e501e5acb4136dcb44e2.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/5cb41dbd487daf7ad6bc9394658d6c8260db8febf0500f71c4b23f69b477a760.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/876c341f79771db8af81e85393e1c09fe6600ce9ab56d29f92b64e417bc5258b.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/74d909a5512cd22ec7222d9741012ae70ced3cf8939bba733710206c27b58de1.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/0ec37e0f3f0fba4c1cdb499fad8bcb8e21d84e3196bc69bbd76e01e782f87c42.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/5ef59fe1a47f428f60a46e5f25288fd08d77880b21da318d87adbc13eccf4c66.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/d72f26125080dac1f25ab5b49761bb4886cfd90055ec22b5698f51605fddd193.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/b605cc52d83b66632810ae71f267a62783c9fddb047f39824b37c57f0e59d4f0.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/76c4cd8348066004e5a6642d147d999586db71735a936b776c423fcd2ce01cdd.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/d4d10bc3347f15e1e0ee5f6216d3784c4e3d26ec724d0eebafb5dcf493839857.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/324751d5ef58ea9cc69a3524b9eb5bd5316cf428bc3421fcd069635614941554.png">
<meta property="og:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/f4f34bae19b892b142a7735f26ec381fcd823f55180592588fb7bd37cedd2034.png">
<meta property="article:published_time" content="2024-05-23T07:30:23.000Z">
<meta property="article:modified_time" content="2024-05-28T05:47:49.262Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/1131847985f79f1f463c35f3eb2ebb5ec2b5e8c3e97b41cdfe9233b2c06d5cf4.png">


<link rel="canonical" href="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/","path":"2024/05/23/nginx/Nginx-配置/","title":"Nginx-配置"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Nginx-配置 | InfoPool</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">InfoPool</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">私人信息记录</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Nginx-%E6%9E%B6%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">Nginx 架构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Nginx%E6%A8%A1%E5%9D%97"><span class="nav-number">2.</span> <span class="nav-text">Nginx模块</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx%E7%9B%AE%E5%BD%95%E4%B8%80%E8%A7%88"><span class="nav-number">3.</span> <span class="nav-text">nginx目录一览</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx-conf%E6%96%87%E4%BB%B6-%E8%A7%A3%E8%AF%BB"><span class="nav-number">4.</span> <span class="nav-text">nginx.conf文件 解读</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-number">5.</span> <span class="nav-text">反向代理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B6%88%E9%99%A4-proxy-pass-%E8%BD%AC%E5%8F%91-x2F-%E7%9A%84%E6%81%90%E6%80%96%E9%98%B4%E5%BD%B1"><span class="nav-number">5.1.</span> <span class="nav-text">消除 proxy_pass 转发 &#x2F;的恐怖阴影</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%B5%81%E7%A8%8B%E4%B8%8E%E5%8E%9F%E7%90%86"><span class="nav-number">5.2.</span> <span class="nav-text">反向代理流程与原理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-number">6.</span> <span class="nav-text">负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx%E5%B8%B8%E7%94%A8%E7%9A%84%E8%B4%9F%E8%BD%BD%E7%AD%96%E7%95%A5"><span class="nav-number">6.1.</span> <span class="nav-text">nginx常用的负载策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AE%E8%AF%A2"><span class="nav-number">6.2.</span> <span class="nav-text">轮询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#weight"><span class="nav-number">6.3.</span> <span class="nav-text">weight</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ip-hash"><span class="nav-number">6.4.</span> <span class="nav-text">ip_hash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#least-conn"><span class="nav-number">6.5.</span> <span class="nav-text">least_conn</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="nav-number">7.</span> <span class="nav-text">动静分离</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%A8%E5%9F%9F"><span class="nav-number">8.</span> <span class="nav-text">跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F"><span class="nav-number">8.1.</span> <span class="nav-text">nginx解决跨域</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%93%E5%AD%98"><span class="nav-number">9.</span> <span class="nav-text">缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%A1%A8%E6%A0%BC%E4%B8%80%E8%A7%88"><span class="nav-number">9.1.</span> <span class="nav-text">nginx缓存配置参数表格一览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8"><span class="nav-number">9.2.</span> <span class="nav-text">nginx缓存使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%BB%91%E7%99%BD%E5%90%8D%E5%8D%95"><span class="nav-number">10.</span> <span class="nav-text">黑白名单</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx%E9%99%90%E6%B5%81"><span class="nav-number">11.</span> <span class="nav-text">nginx限流</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx%E9%99%90%E6%B5%81%E9%85%8D%E7%BD%AE%E8%A7%A3%E9%87%8A"><span class="nav-number">11.1.</span> <span class="nav-text">nginx限流配置解释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx%E9%99%90%E6%B5%81%EF%BC%88%E9%92%88%E5%AF%B9%E8%AF%B7%E6%B1%82%E9%80%9F%E7%8E%87%EF%BC%89"><span class="nav-number">11.2.</span> <span class="nav-text">nginx限流（针对请求速率）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx%E9%99%90%E6%B5%81%EF%BC%88%E9%92%88%E5%AF%B9%E8%BF%9E%E6%8E%A5%E6%95%B0%E9%87%8F%EF%BC%89"><span class="nav-number">11.3.</span> <span class="nav-text">nginx限流（针对连接数量）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#if"><span class="nav-number">12.</span> <span class="nav-text">if</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%A6%82"><span class="nav-number">12.1.</span> <span class="nav-text">例如</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#auto-index"><span class="nav-number">13.</span> <span class="nav-text">auto_index</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#root-amp-alias"><span class="nav-number">14.</span> <span class="nav-text">root&amp;alias</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#root"><span class="nav-number">14.1.</span> <span class="nav-text">root</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#alias"><span class="nav-number">14.2.</span> <span class="nav-text">alias</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-pass-%E4%B8%AD%E7%9A%84%E6%96%9C%E7%BA%BF%E4%B8%8Eroot%E5%92%8C-alias%E7%9A%84%E7%9B%B8%E4%BC%BC%E4%B9%8B%E5%A4%84"><span class="nav-number">14.3.</span> <span class="nav-text">proxy_pass 中的斜线与root和 alias的相似之处</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#upstream-%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%87%A0%E4%B8%AA%E6%8C%87%E4%BB%A4"><span class="nav-number">15.</span> <span class="nav-text">upstream 中常用的几个指令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%87%8D%E8%AF%95%E7%AD%96%E7%95%A5"><span class="nav-number">16.</span> <span class="nav-text">重试策略</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E4%B8%8D%E5%8F%AF%E7%94%A8%E9%87%8D%E8%AF%95"><span class="nav-number">16.1.</span> <span class="nav-text">服务不可用重试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E9%87%8D%E8%AF%95"><span class="nav-number">16.2.</span> <span class="nav-text">错误重试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#backup"><span class="nav-number">16.3.</span> <span class="nav-text">backup</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9"><span class="nav-number">17.</span> <span class="nav-text">压缩</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4nginx-conf%E6%96%87%E4%BB%B6"><span class="nav-number">18.</span> <span class="nav-text">完整nginx.conf文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">19.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">记录信息来源网络，内容只为方便查找，非公开信息，非请勿入</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leetao50.github.io/2024/05/23/nginx/Nginx-%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="InfoPool">
      <meta itemprop="description" content="记录信息来源网络，内容只为方便查找，非公开信息，非请勿入">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Nginx-配置 | InfoPool">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Nginx-配置
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-05-23 15:30:23" itemprop="dateCreated datePublished" datetime="2024-05-23T15:30:23+08:00">2024-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-05-28 13:47:49" itemprop="dateModified" datetime="2024-05-28T13:47:49+08:00">2024-05-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Nginx-架构"><a href="#Nginx-架构" class="headerlink" title="Nginx 架构"></a>Nginx 架构</h1><p><img src="1131847985f79f1f463c35f3eb2ebb5ec2b5e8c3e97b41cdfe9233b2c06d5cf4.png" alt="图 0"><br>从上边这张图，我们可以一览nginx的架构设计，首先我们可以直观得出nginx的几大特点：</p>
<ol>
<li>事件驱动&amp;异步非阻塞</li>
<li>多进程机制</li>
<li>服务端缓存</li>
<li>反向代理</li>
</ol>
<h1 id="Nginx模块"><a href="#Nginx模块" class="headerlink" title="Nginx模块"></a>Nginx模块</h1><p><img src="dcb9be47fd4ef765e7f7768f5cb9fe70c8cf416be6f139e49c80a19f6408c47f.png" alt="图 1">  </p>
<ul>
<li><strong>核心模块</strong> ：是nginx 服务器正常运行必不可少的模块，提供错误日志记录、配置文件解析、事件驱动<br>机制、进程管理等核心功能</li>
<li><strong>标准HTTP模块</strong> ：提供 HTTP 协议解析相关的功能，如：端口配置、网页编码设置、HTTP 响应头设<br>置等</li>
<li><strong>可选HTTP模块</strong> ：主要用于扩展标准的 HTTP 功能，让nginx能处理一些特殊的服务，如：Flash 多<br>媒体传输、解析 GeoIP 请求、SSL 支持等</li>
<li><strong>邮件服务模块</strong> ：主要用于支持 nginx  的邮件服务，包括对 POP3 协议、IMAP 协议和 SMTP 协议的支持</li>
<li><strong>第三方模块</strong> ：是为了扩展 Nginx 服务器应用，完成开发者自定义功能，如：Json 支持、Lua 支持等</li>
</ul>
<h1 id="nginx目录一览"><a href="#nginx目录一览" class="headerlink" title="nginx目录一览"></a>nginx目录一览</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# tree  /usr/local/nginx/  -L 2</span><br><span class="line">/usr/local/nginx/</span><br><span class="line">├── conf                        #存放一系列配置文件的目录</span><br><span class="line">│   ├── fastcgi.conf           #fastcgi程序相关配置文件</span><br><span class="line">│   ├── fastcgi.conf.default   #fastcgi程序相关配置文件备份</span><br><span class="line">│   ├── fastcgi_params         #fastcgi程序参数文件</span><br><span class="line">│   ├── fastcgi_params.default #fastcgi程序参数文件备份</span><br><span class="line">│   ├── koi-utf           #编码映射文件</span><br><span class="line">│   ├── koi-win           #编码映射文件</span><br><span class="line">│   ├── mime.types        #媒体类型控制文件</span><br><span class="line">│   ├── mime.types.default #媒体类型控制文件备份</span><br><span class="line">│   ├── nginx.conf        #主配置文件</span><br><span class="line">│   ├── nginx.conf.default #主配置文件备份</span><br><span class="line">│   ├── scgi_params      #scgi程序相关配置文件</span><br><span class="line">│   ├── scgi_params.default #scgi程序相关配置文件备份</span><br><span class="line">│   ├── uwsgi_params       #uwsgi程序相关配置文件</span><br><span class="line">│   ├── uwsgi_params.default #uwsgi程序相关配置文件备份</span><br><span class="line">│   └── win-utf          #编码映射文件</span><br><span class="line">├── html                 #存放网页文档</span><br><span class="line">│   ├── 50x.html         #错误页码显示网页文件</span><br><span class="line">│   └── index.html       #网页的首页文件</span><br><span class="line">├── logs                 #存放nginx的日志文件</span><br><span class="line">├── sbin                #存放启动程序</span><br><span class="line">│   ├── nginx           #nginx启动程序</span><br><span class="line">│   └── nginx.old       </span><br></pre></td></tr></table></figure>

<h1 id="nginx-conf文件-解读"><a href="#nginx-conf文件-解读" class="headerlink" title="nginx.conf文件 解读"></a>nginx.conf文件 解读</h1><p>首先我们要知道nginx.conf文件是由一个一个的指令块组成的，nginx用{}标识一个指令块，指令块中再设置具体的指令(注意<strong>指令必须以;号结尾</strong>)。<br>指令块有：</p>
<ol>
<li>全局模块</li>
<li>events模块</li>
<li>http模块</li>
<li>server模块</li>
<li>location模块</li>
<li>upstream模块</li>
</ol>
<p>精简后的结构如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">全局模块</span><br><span class="line">event模块</span><br><span class="line">http模块</span><br><span class="line">    upstream模块</span><br><span class="line">    </span><br><span class="line">    server模块</span><br><span class="line">        location块</span><br><span class="line">        location块</span><br><span class="line">        ....</span><br><span class="line">    server模块</span><br><span class="line">        location块</span><br><span class="line">        location块</span><br><span class="line">        ...</span><br><span class="line">    ....    </span><br></pre></td></tr></table></figure>
<p><strong>各模块的功能作用如下描述：</strong></p>
<ol>
<li>全局模块： 配置影响nginx全局的指令，比如运行nginx的用户名，nginx进程pid存放路径，日志存放路径，配置文件引入，worker进程数等。</li>
<li>events块： 配置影响nginx服务器或与用户的网络连接。比如每个进程的最大连接数，选取哪种事件驱动模型（select&#x2F;poll epoll或者是其他等等nginx支持的）来处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</li>
<li>http块： 可以嵌套多个server，配置代理，缓存，日志格式定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。</li>
<li>upstream块： 配置上游服务器的地址以及负载均衡策略和重试策略等等。</li>
<li>server块： 配置虚拟主机的相关参数比如域名端口等等，一个http中可以有多个server。</li>
<li>location块： 配置url路由规则。</li>
</ol>
<p><strong>下面看下nginx.conf长啥样并对一些指令做个解释：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：有些指令是可以在不同指令块使用的（需要时可以去官网看看对应指令的作用域）。这里只是演示</span></span><br><span class="line"></span><br><span class="line">[root@localhost /usr/local/nginx]# cat /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">user  nobody; <span class="comment"># 指定Nginx Worker进程运行用户以及用户组，默认由nobody账号运行</span></span></span><br><span class="line"></span><br><span class="line">worker_processes  1;  # 指定工作进程的个数，默认是1个。具体可以根据服务器cpu数量进行设置， 比如cpu有4个，可以设置为4。如果不知道cpu的数量，可以设置为auto。 nginx会自动判断服务器的cpu个数，并设置相应的进程数</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">error_log  logs/error.log;  <span class="comment"># 用来定义全局错误日志文件输出路径，这个设置也可以放入http块，server块，日志输出级别有debug、info、notice、warn、error、crit可供选择，其中，debug输出日志最为最详细，而crit输出日志最少。</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">error_log  logs/error.log  info; <span class="comment"># 指定error日志位置和日志级别</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pid        logs/nginx.pid;  <span class="comment"># 用来指定进程pid的存储文件位置</span></span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    accept_mutex on;   # 设置网路连接序列化，防止惊群现象发生，默认为on</span><br><span class="line">    </span><br><span class="line">    # Nginx支持的工作模式有select、poll、kqueue、epoll、rtsig和/dev/poll，其中select和poll都是标准的工作模式，kqueue和epoll是高效的工作模式，不同的是epoll用在Linux平台上，而kqueue用在BSD系统中，对于Linux系统，epoll工作模式是首选</span><br><span class="line">    use epoll;</span><br><span class="line">    </span><br><span class="line">    # 用于定义Nginx每个工作进程的最大连接数，默认是1024。最大客户端连接数由worker_processes和worker_connections决定，即Max_client=worker_processes*worker_connections在作为反向代理时，max_clients变为：max_clients = worker_processes *worker_connections/4。进程的最大连接数受Linux系统进程的最大打开文件数限制，在执行操作系统命令“ulimit -n 65536”后worker_connections的设置才能生效</span><br><span class="line">    worker_connections  1024; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对HTTP服务器相关属性的配置如下</span></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types; # 引入文件类型映射文件 </span><br><span class="line">    default_type  application/octet-stream; # 如果没有找到指定的文件类型映射 使用默认配置 </span><br><span class="line">    # 设置日志打印格式</span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">    # </span><br><span class="line">    #access_log  logs/access.log  main; # 设置日志输出路径以及 日志级别</span><br><span class="line">    sendfile        on; # 开启零拷贝 省去了内核到用户态的两次copy故在文件传输时性能会有很大提升</span><br><span class="line">    #tcp_nopush     on; # 数据包会累计到一定大小之后才会发送，减小了额外开销，提高网络效率</span><br><span class="line">    keepalive_timeout  65; # 设置nginx服务器与客户端会话的超时时间。超过这个时间之后服务器会关闭该连接，客户端再次发起请求，则需要再次进行三次握手。</span><br><span class="line">    #gzip  on; # 开启压缩功能，减少文件传输大小，节省带宽。</span><br><span class="line">    sendfile_max_chunk 100k; #每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span><br><span class="line">    </span><br><span class="line">    # 配置你的上游服务（即被nginx代理的后端服务）的ip和端口/域名</span><br><span class="line">    upstream backend_server &#123; </span><br><span class="line">        server 172.30.128.65:8080;</span><br><span class="line">        server 172.30.128.65:8081 backup; #备机</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80; #nginx服务器监听的端口</span><br><span class="line">        server_name  localhost; #监听的地址 nginx服务器域名/ip 多个使用英文逗号分割</span><br><span class="line">        #access_log  logs/host.access.log  main; # 设置日志输出路径以及 级别，会覆盖http指令块的access_log配置</span><br><span class="line">        </span><br><span class="line">        # location用于定义请求匹配规则。 以下是实际使用中常见的3中配置（即分为：首页，静态，动态三种）</span><br><span class="line">       </span><br><span class="line">        # 第一种：直接匹配网站根目录，通过域名访问网站首页比较频繁，使用这个会加速处理，一般这个规则配成网站首页，假设此时我们的网站首页文件就是： usr/local/nginx/html/index.html</span><br><span class="line">        location = / &#123;  </span><br><span class="line">            root   html; # 静态资源文件的根目录 比如我的是 /usr/local/nginx/html/</span><br><span class="line">            index  index.html index.htm; # 静态资源文件名称 比如：网站首页html文件</span><br><span class="line">        &#125;</span><br><span class="line">        # 第二种：静态资源匹配（静态文件修改少访问频繁，可以直接放到nginx或者统一放到文件服务器，减少后端服务的压力），假设把静态文件我们这里放到了 usr/local/nginx/webroot/static/目录下</span><br><span class="line">        location ^~ /static/ &#123;</span><br><span class="line">            alias /webroot/static/; #访问 ip:80/static/xxx.jpg后，将会去获取/url/local/nginx/webroot/static/xxx.jpg 文件并响应</span><br><span class="line">        &#125;</span><br><span class="line">        # 第二种的另外一种方式：拦截所有 后缀名是gif,jpg,jpeg,png,css.js,ico这些 类静态的的请求，让他们都去直接访问静态文件目录即可</span><br><span class="line">        location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ &#123;</span><br><span class="line">            root /webroot/static/;</span><br><span class="line">        &#125;</span><br><span class="line">        # 第三种：用来拦截非首页、非静态资源的动态数据请求，并转发到后端应用服务器 </span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend_server; #请求转向 upstream是backend_server 指令块所定义的服务器列表</span><br><span class="line">            deny 192.168.3.29; #拒绝的ip （黑名单）</span><br><span class="line">            allow 192.168.5.10; #允许的ip（白名单）</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        # 定义错误返回的页面，凡是状态码是 500 502 503 504 总之50开头的都会返回这个 根目录下html文件夹下的50x.html文件内容</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    # 其余的server配置 ,如果有需要的话</span><br><span class="line">    #server &#123;</span><br><span class="line">        ......</span><br><span class="line">    #    location / &#123;</span><br><span class="line">               ....</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line">    </span><br><span class="line">    # include /etc/nginx/conf.d/*.conf;  # 一般我们实际使用中有很多配置，通常的做法并不是将其直接写到nginx.conf文件，</span><br><span class="line">    # 而是写到新文件 然后使用include指令 将其引入到nginx.conf即可，这样使得主配置nginx.conf文件更加清晰。</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是nginx.conf文件的配置了，主要讲了一些指令的含义，当然实际的指令有很多，我在配置文件并没有全部写出来，准备放到后边章节详细阐述这些东西，比如：location匹配规则，反向代理，动静分离，负载均衡策略，重试策略，压缩，https,限流，缓存，跨域这些 我们都没细说，这些东西比较多比较细不可能把使用规则和细节都写到上边的配置文件中，所以我们下边一一解释说明关于这些东西的配置和使用方式。</p>
<p>另外值的注意的是： 因为有些指令是可以在不同作用域使用的，如果在多个作用域都有相同指令的使用，那么nginx将会遵循就近原则或者我愿称之为 内层配置优先。 eg: 你在 http配了日志级别，也在某个server中配了日志级别，那么这个server将使用他自己配置的已不使用外层的http日志配置。</p>
<h1 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h1><p><img src="906719353d4c09aff2cc5893b4f7268ea6c9212e6b2abe5e8029ad1c30606f5d.png" alt="图 2">  </p>
<p>要让 nginx 代理 我们的 服务 很简单，简单描述一下就是 两步：</p>
<p>通过upstream指令块来定义我们的上游服务（即被代理的服务）<br>通过location指令块中的 proxy_pass指令，指定该location要路由到哪个upstream</p>
<p>配置好1和2后，如果来了请求后 会通过url路由到对应的location, 然后nginx会将请求打到upstream定义的服务地址中去。<br><img src="10a064ec18361b3d955e76e0ca66fd30f73116bb5b64f3fc94e68e99d9fccf3c.png" alt="图 3">  </p>
<blockquote>
<p><strong>注意上边的 proxy_pass <a target="_blank" rel="noopener" href="http://mybackendserver/">http://mybackendserver/</a> 后边这个斜线加和不加区别挺大的，加的话不会拼接&#x2F;backend , 而不加的话会拼接 &#x2F;backend</strong></p>
</blockquote>
<h2 id="消除-proxy-pass-转发-x2F-的恐怖阴影"><a href="#消除-proxy-pass-转发-x2F-的恐怖阴影" class="headerlink" title="消除 proxy_pass 转发 &#x2F;的恐怖阴影"></a>消除 proxy_pass 转发 &#x2F;的恐怖阴影</h2><p>在配置Nginx过程中路由转发的一个小小 &#x2F; 可能会给你带来很多麻烦，虽然只是一个小小的斜杠，但是转发的结果千差万别</p>
<ol>
<li>proxy_pass 不带&#x2F;</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /alpha/ &#123;</span><br><span class="line">    proxy_pass  http://<span class="number">192.168</span>.xxx.xxx:<span class="number">80</span>;</span><br><span class="line">&#125;</span><br><span class="line">http://domain/alpha/ --&gt; http://<span class="number">192.168</span>.xxx.xxx:<span class="number">80</span>/alpha/</span><br><span class="line">http://domain/alpha/beta/abc --&gt; http://<span class="number">192.168</span>.xxx.xxx:<span class="number">80</span>/alpha/beta/abc</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>proxy_pass 带&#x2F;</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /alpha/ &#123;</span><br><span class="line">    proxy_pass  http://<span class="number">192.168</span>.xxx.xxx:<span class="number">80</span>/;</span><br><span class="line">&#125;</span><br><span class="line">http://domain/alpha/ --&gt; http://<span class="number">192.168</span>.xxx.xxx:<span class="number">80</span>/</span><br><span class="line">http://domain/alpha/beta/abc --&gt; http://<span class="number">192.168</span>.xxx.xxx:<span class="number">80</span>/beta/abc</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="反向代理流程与原理"><a href="#反向代理流程与原理" class="headerlink" title="反向代理流程与原理"></a>反向代理流程与原理</h2><p>对于上边演示的反向代理案例的流程与原理，我们来个示意图如下<br><img src="02ccd71b11335caae443ba0c6391dd9fe671526e6a630859838ed2f63b91273f.png" alt="图 4">  </p>
<h1 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h1><p>说到负载均衡很多人应该并不陌生，总而言之负载均衡就是：避免高并发高流量时请求都聚集到某一个服务或者某几个服务上，而是让其均匀分配（或者能者多劳），从而减少高并发带来的系统压力，从而让服务更稳定。对于nginx来说，负载均衡就是从 upstream 模块定义的后端服务器列表中按照配置的负载策略选取一台服务器接受用户的请求。</p>
<h2 id="nginx常用的负载策略"><a href="#nginx常用的负载策略" class="headerlink" title="nginx常用的负载策略"></a>nginx常用的负载策略</h2><ol>
<li>轮询(默认方式)<ol>
<li>每个请求会按时间顺序逐一分配到不同的后端服务器 </li>
<li>在轮询中，如果服务器down掉了，会自动剔除该服务器</li>
<li>缺省配置就是轮询策略</li>
<li>此策略适合服务器配置相当，无状态且短平快的服务使用</li>
</ol>
</li>
<li>weight(权重方式)<ol>
<li>在轮询策略的基础上指定轮询的几率</li>
<li>权重越高分配到的请求越多</li>
<li>此策略可以与least_conn和ip_hash结合使用</li>
<li>此策略比较适合服务器的硬件配置差别比较大的情况</li>
</ol>
</li>
<li>ip_hash(依据ip的hash值来分配)<ol>
<li>在nginx版本1.3.1之前，不能在ip_hash中使用权重（weight）</li>
<li>ip_hash不能与backup同时使用</li>
<li>此策略适合有状态服务，比如session</li>
<li>当有服务器需要剔除，必须手动down掉</li>
</ol>
</li>
<li>least_conn(最少连接方式)<ol>
<li>此负载均衡策略适合请求处理时间长短不一造成服务器过载的情况</li>
</ol>
</li>
<li>fair(响应时间方式)<ol>
<li>根据后端服务器的响应时间来分配请求，响应时间短的优先分配</li>
<li>Nginx本身不支持fair，如果需要这种调度算法，则必须安装upstream_fair模块</li>
</ol>
</li>
<li>url_hash(依据URL分配方式)<ol>
<li>按访问的URL的哈希结果来分配请求，使每个URL定向到一台后端服务器</li>
<li>Nginx本身不支持url_hash，如果需要这种调度算法，则必须安装Nginx的hash软件包</li>
</ol>
</li>
</ol>
<h2 id="轮询"><a href="#轮询" class="headerlink" title="轮询"></a>轮询</h2><p>轮询策略是默认的，所以只需要如下这样修改配置文件就可以了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_server &#123; </span><br><span class="line">    ip_hash</span><br><span class="line">    server 172.30.128.65:8080;</span><br><span class="line">    server 172.30.128.65:8081;</span><br><span class="line">    server 172.30.128.65:8082;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="weight"><a href="#weight" class="headerlink" title="weight"></a>weight</h2><p>weight指令用于指定轮询机率，weight的默认值为1，weight的数值与访问比率成正比。 接下来我们指定8082端口的服务的weight&#x3D;2，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_server &#123; </span><br><span class="line">    ip_hash</span><br><span class="line">    server 172.30.128.65:8080;</span><br><span class="line">    server 172.30.128.65:8081;</span><br><span class="line">    server 172.30.128.65:8082 weight=2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ip-hash"><a href="#ip-hash" class="headerlink" title="ip_hash"></a>ip_hash</h2><p>设定ip哈希很简单，就是在你的upstream中 指定 ip_hash;即可，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_server &#123; </span><br><span class="line">    ip_hash;</span><br><span class="line">    server 172.30.128.65:8080;</span><br><span class="line">    server 172.30.128.65:8081;</span><br><span class="line">    server 172.30.128.65:8083;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="least-conn"><a href="#least-conn" class="headerlink" title="least_conn"></a>least_conn</h2><p>同ip_hash一样，设定最小连接数策略也很简单，就是在你的upstream中 指定 least_conn;即可，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_server &#123; </span><br><span class="line">    least_conn;</span><br><span class="line">    server 172.30.128.65:8080;</span><br><span class="line">    server 172.30.128.65:8081;</span><br><span class="line">    server 172.30.128.65:8083;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h1><p>如果将静态资源都搞到后端服务的话，将会提高后端服务的压力且占用带宽增加了系统负载（要知道，静态资源的访问频率其实蛮高的）所以为了避免该类问题我们可以把不常修改的静态资源文件放到nginx的静态资源目录中去，这样在访问静态资源时直接读取nginx服务器本地文件目录之后返回，这样就大大减少了后端服务的压力同时也加快了静态资源的访问速度，何为静，何为动呢？：</p>
<ul>
<li>静：将不常修改且访问频繁的静态文件，放到nginx本地静态目录（当然也可以搞个静态资源服务器专门存放所有静态文件）</li>
<li>动：将变动频繁&#x2F;实时性较高的比如后端接口，实时转发到对应的后台服务</li>
</ul>
<p>接下来我们将构造一个html页面，然后点击按钮后发送get请求到后端接口。流程如下：<br><img src="90b8227be27efbd64a2f46dd65b82a17719c01f4de358202c1b00c9fce4cfe5a.png" alt="图 7"><br>首先我们搞个html,内容如下：<br><img src="ba4dafbbf05c7421b7e3406341dc794a348f94c38224aa11be57060f7d728ebd.png" alt="图 8"><br>命令将index_page.html 文件上传到虚拟机。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp /Users/hzz/fsdownload/index_page.html root@172.30.128.65:/usr/local/nginx/test/static</span><br></pre></td></tr></table></figure>

<p><strong>修改nginx.conf文件</strong><br>首先我们配置俩location规则,一个（ &#x2F;frontend ）是读取静态文件，一个（&#x2F;backend）是转发到 我们配置的upstream服务中去。如下：<br><img src="75505aff0f154ef619465c07e5ff92c4255343489c38e501e5acb4136dcb44e2.png" alt="图 9"><br>首先我们在浏览器输入：<a target="_blank" rel="noopener" href="http://www.xxx.com/frontend/">www.xxx.com/frontend/</a> ，可以看到请求返回了一个html页面，其实就是我们刚才的 &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;test&#x2F;static&#x2F;index_page.html文件<br><img src="5cb41dbd487daf7ad6bc9394658d6c8260db8febf0500f71c4b23f69b477a760.png" alt="图 10"><br>接着我们输入要查询的人名，之后点击 “调用get接口” 按钮，如下：<br><img src="876c341f79771db8af81e85393e1c09fe6600ce9ab56d29f92b64e417bc5258b.png" alt="图 11"><br>返回数据：<br><img src="74d909a5512cd22ec7222d9741012ae70ced3cf8939bba733710206c27b58de1.png" alt="图 12">  </p>
<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><p>产生跨域问题的主要原因就在于同源策略，为了保证用户信息安全，防止恶意网站窃取数据，同源策略是必须的，该政策由 Netscape 公司于1995年引入浏览器。目前，所有浏览器都实行这个政策。同源策略主要是指三点相同即：协议+域名+端口 相同的两个请求，则可以被看做是同源的，但如果其中任意一点存在不同，则代表是两个不同源的请求，同源策略会限制不同源之间的资源交互从而减少数据安全问题。</p>
<p>首先我在nginx.conf文件中加一个server配置也即将前后端配成不同的server 并且监听的端口以及域名名称都不一致，从而造成访问前端服务和后端服务时候 这俩服务不是”同源”， 如下：<br><img src="0ec37e0f3f0fba4c1cdb499fad8bcb8e21d84e3196bc69bbd76e01e782f87c42.png" alt="图 13"><br>之后我修改index_page中的后端地址：<br><img src="5ef59fe1a47f428f60a46e5f25288fd08d77880b21da318d87adbc13eccf4c66.png" alt="图 14"><br>之后在浏览器中测试一下：<br><img src="d72f26125080dac1f25ab5b49761bb4886cfd90055ec22b5698f51605fddd193.png" alt="图 15"><br>可以看到浏览器提示我们受同源规则影响我们不能跨域访问资源。造成的原因是我的两个域名解析出来的端口不一致 一个是80一个是90。不符合同源策略，所以必然会有跨域报错。</p>
<h2 id="nginx解决跨域"><a href="#nginx解决跨域" class="headerlink" title="nginx解决跨域"></a>nginx解决跨域</h2><p>首先想解决跨越就得避免不同源，而我们可不可以 把对后端的代理 放在前端的server中呢（也就是说让前后端统一使用一个端口，一个server_name）？答案是可以的，因为server支持多个location配置呀（一个location处理前端，一个location转发后端），我们改下配置文件试一把如下：<br><img src="b605cc52d83b66632810ae71f267a62783c9fddb047f39824b37c57f0e59d4f0.png" alt="图 16"><br>之后重启nginx后在浏览器输入 <a target="_blank" rel="noopener" href="http://www.xxxadminsystem.com/page/">www.xxxadminsystem.com/page/</a> ，效果如下：<br><img src="76c4cd8348066004e5a6642d147d999586db71735a936b776c423fcd2ce01cdd.png" alt="图 17"><br>上边&#x2F;page请求返回了html页面之后我们输入参数点击“调用get接口”查看到后端接口的调用如下：<br><img src="d4d10bc3347f15e1e0ee5f6216d3784c4e3d26ec724d0eebafb5dcf493839857.png" alt="图 18">  </p>
<h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><p>在开头我们就介绍过，nginx代理缓存可以在某些场景下有效的减少服务器压力，让请求快速响应，从而提升用户体验和服务性能，那么nginx缓存如何使用呢？在使用及演示前我们先来熟悉下相关的配置以及其含义，知道了这些才能更好的使用nginx缓存。</p>
<h2 id="nginx缓存配置参数表格一览"><a href="#nginx缓存配置参数表格一览" class="headerlink" title="nginx缓存配置参数表格一览"></a>nginx缓存配置参数表格一览</h2><ul>
<li>proxy_cache：设置是否开启对后端响应的缓存。<ul>
<li>语法：proxy_cache zone | off;	</li>
<li>默认配置：proxy_cache off;	</li>
<li>示例：proxy_cache mycache; # 规定开启nginx缓存并且缓存名称为: mycache	</li>
<li>作用域：http, server, location</li>
</ul>
</li>
<li>proxy_cache_valid：配置什么状态码可以被缓存，以及缓存时长	<ul>
<li>语法：proxy_cache_valid [code …] time;	</li>
<li>示例：proxy_cache_valid 200 304 2m; # 对于状态为200和304的缓存文件，缓存时间是2分钟</li>
<li>作用域：http, server, location</li>
</ul>
</li>
<li>proxy_cache_key：设置缓存文件的 key	<ul>
<li>语法：proxy_cache_key string;	</li>
<li>默认配置：proxy_cache_key：$scheme $proxy_host $request_uri;</li>
<li>示例：proxy_cache_key “$host $request_uri $cookie_user”; # 使用host +请求的uri以及cookie拼接成缓存key</li>
<li>作用域：http, server, location</li>
</ul>
</li>
</ul>
<p>事实上，ngx_http_proxy_module模块中代理缓存proxy_cache相关的指令远不止这些，如果有需要请参考： nginx官方文档。<a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html?_ga=2.13518455.1300709501.1700036543-1660479828.1698914648#proxy_cache">https://nginx.org/en/docs/http/ngx_http_proxy_module.html?_ga=2.13518455.1300709501.1700036543-1660479828.1698914648#proxy_cache</a></p>
<h2 id="nginx缓存使用"><a href="#nginx缓存使用" class="headerlink" title="nginx缓存使用"></a>nginx缓存使用</h2><p>接下来我们修改下nginx.conf文件,如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    # 指定缓存存放目录为/usr/local/nginx/test/nginx_cache_storage，并设置缓存名称为mycache，大小为64m， 1天未被访问过的缓存将自动清除，磁盘中缓存的最大容量为1gb</span><br><span class="line">    proxy_cache_path /usr/local/nginx/test/nginx_cache_storage levels=1:2 keys_zone=mycache:64m inactive=1d max_size=1g;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    server&#123;</span><br><span class="line">        ...</span><br><span class="line">        #  指定 username 参数中只要有字母 就不走nginx缓存  </span><br><span class="line">        if ($arg_username ~ [a-z]) &#123;</span><br><span class="line">             set $cache_name &quot;no cache&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location  /interface &#123;</span><br><span class="line">                   proxy_pass http://mybackendserver/;</span><br><span class="line">                   # 使用名为 mycache 的缓存空间</span><br><span class="line">                   proxy_cache mycache;</span><br><span class="line">                   # 对于200 206 状态码的数据缓存2分钟</span><br><span class="line">                   proxy_cache_valid 200 206 2m;</span><br><span class="line">                   # 定义生成缓存键的规则（请求的url+参数作为缓存key）</span><br><span class="line">                   proxy_cache_key $host$uri$is_args$args;</span><br><span class="line">                   # 资源至少被重复访问2次后再加入缓存</span><br><span class="line">                   proxy_cache_min_uses 3;</span><br><span class="line">                   # 出现重复请求时，只让其中一个去后端读数据，其他的从缓存中读取</span><br><span class="line">                   proxy_cache_lock on;</span><br><span class="line">                   # 上面的锁 超时时间为4s，超过4s未获取数据，其他请求直接去后端</span><br><span class="line">                   proxy_cache_lock_timeout 4s;</span><br><span class="line">                   # 对于请求参数中有字母的 不走nginx缓存</span><br><span class="line">                   proxy_no_cache $cache_name; # 判断该变量是否有值，如果有值则不进行缓存，没有值则进行缓存</span><br><span class="line">                   # 在响应头中添加一个缓存是否命中的状态（便于调试）</span><br><span class="line">                   add_header Cache-status $upstream_cache_status;    </span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ps: 在上边配置文件中除了缓存相关的配置，我们还加了一个参数：</p>
<p><code>add_header Cache-status $upstream_cache_status;</code><br>这个参数可以方便从响应头看到是否命中了nginx缓存，方便我们观察，其不同的值有不同的含义，</p>
<blockquote>
<p>upstream_cache_status的值集合如下：</p>
</blockquote>
<ul>
<li>MISS：请求未命中缓存</li>
<li>HIT：请求命中缓存。</li>
<li>EXPIRED：请求命中缓存但缓存已过期。</li>
<li>STALE：请求命中了陈旧缓存。</li>
<li>REVALIDDATED：Nginx验证陈旧缓存依然有效。</li>
<li>UPDATING：命中的缓存内容陈旧，但正在更新缓存。</li>
<li>BYPASS：响应结果是从原始服务器获取的。</li>
</ul>
<h1 id="黑白名单"><a href="#黑白名单" class="headerlink" title="黑白名单"></a>黑白名单</h1><p>nginx黑白名单比较简单，allow后配置你的白名单，deny后配置你的黑名单，在实际使用中，我们一般都是建个黑名单和白名单的文件然后再nginx.copnf中incluld一下，这样保持主配置文件整洁，也好管理。下边我为了方便就直接在主配置写了。<br><img src="324751d5ef58ea9cc69a3524b9eb5bd5316cf428bc3421fcd069635614941554.png" alt="图 19"><br>可以看到ip 可以是ipv4 也可以是ipv6 也可以按照网段来配置，当然ip黑白配置可以在 http，server，location和limit_except这几个域都可以区别只是作用粒度大小问题。当然nginx建议我们使用 ngx_http_geo_module这个库，ngx_http_geo_module库支持 按地区、国家进行屏蔽，并且提供了IP库，当需要配置的名单比较多或者根据地区国家屏蔽时这个库可以帮上大忙。</p>
<h1 id="nginx限流"><a href="#nginx限流" class="headerlink" title="nginx限流"></a>nginx限流</h1><p>Nginx主要有两种限流方式：按并发连接数限流(ngx_http_limit_conn_module)、按请求速率限流(ngx_http_limit_req_module 使用的令牌桶算法)。<br>关于  ngx_http_limit_req_module模块，里边有很多种限流指令，官网资料一览：</p>
<p>我们下面使用 ngx_http_limit_req_module 模块中的limit_req_zone和 limit_req 这两个指令来达到限制单个IP的请求速率 的目的。</p>
<h2 id="nginx限流配置解释"><a href="#nginx限流配置解释" class="headerlink" title="nginx限流配置解释"></a>nginx限流配置解释</h2><p> 在 nginx.conf 中添加限流配置如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    # 对请求速率限流</span><br><span class="line">    limit_req_zone $binary_remote_addr zone=myRateLimit:10m rate=5r/s;</span><br><span class="line">    </span><br><span class="line">    server&#123;</span><br><span class="line">        location /interface&#123;</span><br><span class="line">            ...</span><br><span class="line">            limit_req zone=myRateLimit burst=5  nodelay;</span><br><span class="line">            limit_req_status 520;</span><br><span class="line">            limit_req_log_level info;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>$binary_remote_addr：表示基于 remote_addr(客户端IP) 来做限流<ul>
<li>zone&#x3D;myRateLimit:10m：表示使用myRateLimit来作为内存区域（存储访问信息）的名字，大小为10M，1M能存储16000 IP地址的访问信息，10M可以存储16W IP地址访问信息</li>
<li>rate&#x3D;5r&#x2F;s：表示相同ip每秒最多请求5次，nginx是精确到毫秒的，也就是说此配置代表每200毫秒处理一个请求，这意味着自上一个请求处理完后，若后续200毫秒内又有请求到达，将拒绝处理该请求（如果没配burst的话）</li>
<li>burst&#x3D;5：(英文 爆发 的意思)，意思是设置一个大小为5的缓冲队列，若同时有6个请求到达，Nginx 会处理第一个请求，剩余5个请求将放入队列，然后每隔200ms从队列中获取一个请求进行处理。若请求数大于6，将拒绝处理多余的请求，直接返回503</li>
<li>nodelay：针对的是 burst 参数，burst&#x3D;5 nodelay 这个配置表示被放到缓冲队列的这5个请求会立马处理，不再是每隔200ms取一个了。但是值得注意的是，即使这5个突发请求立马处理并结束，后续来了请求也不一定不会立马处理，因为虽然请求被处理了但是请求所占的坑并不会被立即释放，而是只能按 200ms 一个来释放，释放一个后 才将等待的请求 入队一个。</li>
<li>另外两个： limit_req_status&#x3D;520表示当被限流后，nginx的返回码，limit_req_log_level info代表日志级别</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意： 如果不开启nodelay且开启了burst这个配置，那么将会严重影响用户体验（你想想假设burst队列长度为100的话每100ms处理一个,那队列最后那个请求得等10000ms&#x3D;10s后才能被处理，那不超时才怪呢此时burst已经意义不大了）所以一般情况下 建议burst和nodelay结合使用，从而尽可能达到速率稳定，但突然流量也能正常处理的效果。</p>
</blockquote>
<h2 id="nginx限流（针对请求速率）"><a href="#nginx限流（针对请求速率）" class="headerlink" title="nginx限流（针对请求速率）"></a>nginx限流（针对请求速率）</h2><p>限制每秒同一ip最多访问5次&#x2F;1s<br>修改nginx.conf，把burst&#x3D;5 nodelay注释掉，如下：	</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    # 对请求速率限流</span><br><span class="line">    limit_req_zone $binary_remote_addr zone=myRateLimit:10m rate=5r/s;</span><br><span class="line">    </span><br><span class="line">    server&#123;</span><br><span class="line">        location /interface&#123;</span><br><span class="line">            ...</span><br><span class="line">            limit_req zone=myRateLimit #burst=5  nodelay;</span><br><span class="line">            limit_req_status 520;</span><br><span class="line">            limit_req_log_level info;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上边的配置意味着每秒最多处理5次同样ip的请求</p>
<p>打开burst参数并设置成5。现在我们的速率不变还是最多5次一秒，但是设置burst&#x3D;5代表缓冲队列的长度为5，nginx每隔200ms，从缓冲队列拿一个进行处理，配置如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    # 对请求速率限流</span><br><span class="line">    limit_req_zone $binary_remote_addr zone=myRateLimit:10m rate=5r/s;</span><br><span class="line">    </span><br><span class="line">    server&#123;</span><br><span class="line">        location /interface&#123;</span><br><span class="line">            ...</span><br><span class="line">            limit_req zone=myRateLimit burst=5  #nodelay;</span><br><span class="line">            limit_req_status 520;</span><br><span class="line">            limit_req_log_level info;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打开nodelay</p>
<p>我们上边说过打开nodlay的话，代表放到burst队列的请求直接处理 ，不再按速率 200ms&#x2F;次 拿了，配置如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    # 对请求速率限流</span><br><span class="line">    limit_req_zone $binary_remote_addr zone=myRateLimit:10m rate=5r/s;</span><br><span class="line">    </span><br><span class="line">    server&#123;</span><br><span class="line">        location /interface&#123;</span><br><span class="line">            ...</span><br><span class="line">            limit_req zone=myRateLimit burst=5  nodelay;</span><br><span class="line">            limit_req_status 520;</span><br><span class="line">            limit_req_log_level info;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>开启nodelay后响应时间10几秒明显比不开启nodelay快很多，但是请求成功的还是6个，因为就像我们上边说的ngdelay虽然会即时处理，但是释放坑位是200ms释放一个 （也就是说即时开启了nodelay 但释放令牌的速度是不变的） ，所以nodelay参数本质上并没有提高访问速率，而仅仅是让处于burst队列的请求 ”被快速处理“ 罢了。</p>
<h2 id="nginx限流（针对连接数量）"><a href="#nginx限流（针对连接数量）" class="headerlink" title="nginx限流（针对连接数量）"></a>nginx限流（针对连接数量）</h2><p>针对连接数量的限流和速率不一样，即使你速率是1ms一次，只要你连接数量不超过设置的，那么也访问成功。如果连接数超过设置的值将会请求失败。值得注意的是他是 ngx_http_limit_conn_module模块中的，不要和 速率限流的 ngx_http_limit_req_module模块搞混了。<br>配置如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    # 针对ip  对请求连接数限流</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone $binary_remote_addr zone=myConnLimit:10m; </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    server&#123;</span><br><span class="line">       ...</span><br><span class="line">       limit_conn myConnLimit 12;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>
<p>limit_conn_zone $binary_remote_addr zone&#x3D;myConnLimit:10m; 代表的意思 是 基于连接数量限流，限流的对象是ip 名称是myConnLimit 存储空间大小10mb（即存放某ip的访问记录），limit_conn myConnLimit 12;标识该ip最大支持12个连接超过则返回503（被限流后状态码默认是503，当然你也可以修改返回码 像上边的 针对请求速率限流 ，返回码就是 我修改的520）。</p>
<h1 id="if"><a href="#if" class="headerlink" title="if"></a>if</h1><p>该指令用于条件判断，并且根据条件判断结果来选择不同的配置，其作用于为：server&#x2F;location 块。这个指令比较简单，因为编程中if语句都是非常高频使用的。因为我们很多时候，都是在对 比如：url  参数 ip 域名等等做比对或者判断（一般都使用正则的方式）,而这些都在nginx全局变量中可以拿到。</p>
<p><strong>if判断指令语法为</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(condition)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;，</span><br></pre></td></tr></table></figure>
<p>对给定的条件condition进行判断。如果为真，大括号内的rewrite等指令将被执行，if条件(conditon)可以是如下任何内容：</p>
<ol>
<li>一个变量名，如果变量 $variable 的值为空字符串或者字符串”0”，则为false</li>
<li>变量与一个字符串的比较 相等为(&#x3D;) 不相等为(!&#x3D;) 注意此处不要把相等当做赋值语句啊</li>
<li>变量与一个正则表达式的模式匹配 操作符可以是(<code>~ 区分大小写的正则匹配， ~*不区分大小写的正则匹配， !~ !~*，前面两者的非</code>)</li>
<li>检测文件是否存在 使用 -f(存在) 和 !-f(不存在)</li>
<li>检测路径是否存在 使用 -d(存在) 和 !-d(不存在) 后面判断可以是字符串也可是变量</li>
<li>检测文件、路径、或者链接文件是否存在 使用 -e(存在) 和 !-e(不存在) 后面判断可以是字符串也可是变量</li>
<li>检测文件是否为可执行文件 使用 -x(可执行) 和 !-x(不可执行) 后面判断可以是字符串也可是变量</li>
</ol>
<p><strong>注意 上面 第1，2，3条被判断的必须是 变量， 4, 5, 6, 7则可以是变量也可是字符串</strong></p>
<h2 id="例如"><a href="#例如" class="headerlink" title="例如"></a>例如</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">set $variable &quot;0&quot;; </span><br><span class="line">if ($variable) &#123;</span><br><span class="line">    # 不会执行，因为 &quot;0&quot; 为 false</span><br><span class="line">    break;            </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用变量与正则表达式匹配 没有问题</span></span><br><span class="line">if ( $http_host ~ &quot;^star\.igrow\.cn$&quot; ) &#123;</span><br><span class="line">    break;            </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">字符串与正则表达式匹配 报错</span></span><br><span class="line">if ( &quot;star&quot; ~ &quot;^star\.igrow\.cn$&quot; ) &#123;</span><br><span class="line">    break;            </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查文件类的 字符串与变量均可</span></span><br><span class="line">if ( !-f &quot;/data.log&quot; ) &#123;</span><br><span class="line">    break;            </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( !-f $filename ) &#123;</span><br><span class="line">    break;            </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">指定 username 参数中只要有字母 就不走nginx缓存</span></span><br><span class="line">if ($arg_username ~ [a-z]) &#123;</span><br><span class="line">    set $cache_name &quot;no cache&quot;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果UA包含<span class="string">&quot;MSIE&quot;</span>，rewrite请求到/msid/目录下</span></span><br><span class="line">if ($http_user_agent ~ MSIE) &#123; </span><br><span class="line">    rewrite ^(.)$ /msie/$1break;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果cookie匹配正则，设置变量<span class="variable">$id</span>等于正则引用部分</span></span><br><span class="line">if ($http_cookie ~ &quot;id=([^;]+)(?:;|$)&quot;) </span><br><span class="line">&#123; </span><br><span class="line">    set$id$1; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果提交方法为POST，则返回状态405（Method not allowed）。<span class="built_in">return</span>不能返回301,302</span></span><br><span class="line">if ($request_method = POST) &#123; </span><br><span class="line">    return405; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">限速，<span class="variable">$slow</span>可以通过 <span class="built_in">set</span> 指令设置</span></span><br><span class="line">if ($slow) &#123; </span><br><span class="line">    limit_rate 10k; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果请求的文件名不存在，则反向代理到localhost 。这里的<span class="built_in">break</span>也是停止rewrite检查</span></span><br><span class="line">if (!-f $request_filename)&#123; </span><br><span class="line">    break; </span><br><span class="line">    proxy_pass http://127.0.0.1; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果querystring中包含<span class="string">&quot;post=140&quot;</span>，永久重定向到example.com</span></span><br><span class="line">if ($args ~ post=140)&#123; </span><br><span class="line">    rewrite ^ http://example.com/ permanent; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">防盗链</span> </span><br><span class="line">location ~* .(gif|jpg|png|swf|flv)$ &#123; </span><br><span class="line">    valid_referers none blocked www.jefflei.com www.leizhenfang.com; </span><br><span class="line">    if ($invalid_referer) &#123; </span><br><span class="line">        return 404; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="auto-index"><a href="#auto-index" class="headerlink" title="auto_index"></a>auto_index</h1><p>我们配置nginx， 使得访问 hzznb-xzll.xyz&#x2F;book&#x2F; 时,返回 &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;test&#x2F;book&#x2F;目录下的书籍，配置如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location /book/ &#123;</span><br><span class="line">          root /usr/local/nginx/test;</span><br><span class="line">          autoindex on; # 打开 autoindex，，可选参数有 on | off</span><br><span class="line">          autoindex_format html; # 以html的方式进行格式化，可选参数有 html | json | xml</span><br><span class="line">          autoindex_exact_size on; # 修改为off，会以KB、MB、GB显示文件大小，默认为on以bytes显示出⽂件的确切⼤⼩</span><br><span class="line">          autoindex_localtime off; # 显示⽂件时间 GMT格式</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重启nginx并在浏览器输入 hzznb-xzll.xyz&#x2F;book&#x2F; （注意book后边的斜线 &#x2F; 不能去掉，否则404了，具体原因我们下边马上会说），看下效果：<br><img src="f4f34bae19b892b142a7735f26ec381fcd823f55180592588fb7bd37cedd2034.png" alt="图 20">  </p>
<h1 id="root-amp-alias"><a href="#root-amp-alias" class="headerlink" title="root&amp;alias"></a>root&amp;alias</h1><p>root和alias 一般都是用于指定静态资源目录，但是还是有区别的，虽然这是个小知识点但是如果你不清楚规则，很容易走弯路，所以这里阐明并演示这俩的区别。</p>
<h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /static/ &#123; #注意static后边的斜线 / 不能去掉，否则404了</span><br><span class="line">    root /usr/local/nginx/test;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，当你请求 <a target="_blank" rel="noopener" href="http://www.hzznb-xzll.xyz/static/imag%E2%80%A6">www.hzznb-xzll.xyz/static/imag…</a> 时，&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;test&#x2F;static&#x2F;image2.jpg  文件将被作为响应内容响应给客户端,也就是说 :<br>root指令会 将 &#x2F;static&#x2F; 拼接到 &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;test 后边<br>即完整目录路径为： &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;test&#x2F;static&#x2F;</p>
<h2 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h2><p>alias 中文意思别名，这个和root最大区别就是 不会进行拼接，下边我们改下nginx.conf文件来演示下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /static &#123; # 注意一般 alias的 url都不带后边的/</span><br><span class="line">     alias /usr/local/nginx/test/; # 使用alias时  这里的目录最后边一定要加/ 否则就404</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上边配置的意思就是当前你访问 <a target="_blank" rel="noopener" href="http://www.hzznb-xzll.xyz/static/imag%E2%80%A6">www.hzznb-xzll.xyz/static/imag…</a> 时，nginx会去alias配置的路径：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;test&#x2F;目录下找 image2.jpg 这个文件从而返回。比如我现在的&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;test&#x2F;目录下没有image2.jpg 文件则返回404。</p>
<h2 id="proxy-pass-中的斜线与root和-alias的相似之处"><a href="#proxy-pass-中的斜线与root和-alias的相似之处" class="headerlink" title="proxy_pass 中的斜线与root和 alias的相似之处"></a>proxy_pass 中的斜线与root和 alias的相似之处</h2><p>在我们上边的负载均衡以及动静锋利等等演示中，可以看到我们的proxy_pass的配置基本上都是这么配的：</p>
<p><code>proxy_pass http://mybackendserver/</code></p>
<p>这里有个东西和root与alias的规则很像，所以我们在这里也提一下，就是 <a target="_blank" rel="noopener" href="http://mybackendserver/">http://mybackendserver/</a> 后边这个斜线 &#x2F;，如果你不写 &#x2F; 则会将location的url拼接到路径后边，如果你写了则不会。</p>
<h1 id="upstream-中常用的几个指令"><a href="#upstream-中常用的几个指令" class="headerlink" title="upstream 中常用的几个指令"></a>upstream 中常用的几个指令</h1><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>server</td>
<td>反向服务地址</td>
</tr>
<tr>
<td>weight</td>
<td>权重</td>
</tr>
<tr>
<td>fail_timeout</td>
<td>与max_fails结合使用。</td>
</tr>
<tr>
<td>max_fails</td>
<td>设置在fail_timeout参数设置的时间内最大失败次数，如果在这个时间内，所有针对该服务器的请求都失败了，那么认为该服务器会被认为是停机了。</td>
</tr>
<tr>
<td>max_conns</td>
<td>允许最大连接数</td>
</tr>
<tr>
<td>fail_time</td>
<td>服务器会被认为停机的时间长度,默认为10s</td>
</tr>
<tr>
<td>backup</td>
<td>标记该服务器为备用服务器，当主服务器停止时，请求会被发送到它这里。</td>
</tr>
<tr>
<td>down</td>
<td>标记服务器永久停机</td>
</tr>
<tr>
<td>slow_start</td>
<td>当节点恢复，不立即加入</td>
</tr>
</tbody></table>
<h1 id="重试策略"><a href="#重试策略" class="headerlink" title="重试策略"></a>重试策略</h1><h2 id="服务不可用重试"><a href="#服务不可用重试" class="headerlink" title="服务不可用重试"></a>服务不可用重试</h2><p>重试是在发生错误时的一种不可缺少的手段，这样当某一个或者某几个服务宕机时（因为我们现在大多都是多实例部署），如果有正常服务，那么将请求 重试到正常服务的机器上去。</p>
<p>下边我们先修改下nginx.conf文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">upstream mybackendserver &#123;</span><br><span class="line">        # 60秒内 如果请求8081端口这个应用失败</span><br><span class="line">        # 3次，则认为该应用宕机 时间到后再有请求进来继续尝试连接宕机应用且仅尝试 1 次，如果还是失败，</span><br><span class="line">        # 则继续等待 60 秒...以此循环，直到恢复</span><br><span class="line">        server 172.30.128.64:8081 fail_timeout=60s max_fails=3; </span><br><span class="line">        </span><br><span class="line">        server 172.30.128.64:8082;</span><br><span class="line">        server 172.30.128.64:8083;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="错误重试"><a href="#错误重试" class="headerlink" title="错误重试"></a>错误重试</h2><p>可以配置哪些状态下 才会执行重试，比如如下这个配置：<br> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定哪些错误状态才执行 重试 比如下边的 error 超时，500,502,503 504</span></span><br><span class="line">proxy_next_upstream error timeout http_500 http_502 http_503 http_504;</span><br></pre></td></tr></table></figure></p>
<h2 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h2><p>Nginx 支持设置备用节点，当所有线上节点都异常时会启用备用节点，同时备用节点也会影响到失败<br>重试的逻辑。</p>
<p>我们可以通过 backup 指令来定义备用服务器，backup有如下特征：</p>
<ol>
<li>正常情况下，请求不会转到 backup 服务器，包括失败重试的场景</li>
<li>当所有正常节点全部不可用时，backup 服务器生效，开始处理请求</li>
<li>一旦有正常节点恢复，就使用已经恢复的正常节点</li>
<li>backup 服务器生效期间，不会存在所有正常节点一次性恢复的逻辑</li>
<li>如果全部 backup 服务器也异常，则会将所有节点一次性恢复，加入存活列表</li>
<li>如果全部节点（包括 backup）都异常了，则 Nginx 返回 502 错误</li>
</ol>
<p>接着我们修改下nginx.conf文件演示下backup的作用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream mybackendserver &#123;</span><br><span class="line">    server 172.30.128.64:8081 fail_timeout=60s max_fails=3; # 60秒内 如果请求某一个应用失败3次，则认为该应用宕机 时间到后再有请求进来继续尝试连接宕机应用且仅尝试 1 次，如果还是失败，则继续等待 60 秒...以此循环，直到恢复</span><br><span class="line">    server 172.30.128.64:8082;</span><br><span class="line">    server 172.30.128.64:8083 backup; # 设置8083位备机</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即使8081 不可用也只是去8082重试而不会到备机重试，如果8081 8082都不可用则请求重试到备机：8083。</p>
<h1 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h1><p>压缩功能比较实用尤其是处理一些大文件时，而gzip 是规定的三种标准 HTTP 压缩格式之一。目前绝大多数的网站都在使用 gzip 传输 HTML 、CSS 、 JavaScript 等资源文件。需要知道的是，并不是每个浏览器都支持 gzip 压缩，如何知道客户端（浏览器）是否支持 压缩 呢？ 可以通过观察 某请求头中的 Accept-Encoding 来观察是否支持压缩，另外只有客户端支持也不顶事，服务端得返回gzip格式的文件呀，那么这件事nginx可以帮我们做，我们可以通过 Nginx 的配置来让服务端支持 gzip。服务端返回压缩文件后浏览器进行解压缩从而展示正常内容。</p>
<p>想要压缩就得配置nginx,修改nginx.conf文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    # 开启/关闭 压缩机制</span><br><span class="line">    gzip on;</span><br><span class="line">    # 根据文件类型选择 是否开启压缩机制</span><br><span class="line">    gzip_types text/plain application/javascript text/css application/xml text/javascript image/jpeg image/jpg image/gif image/png  application/json;</span><br><span class="line">    # 设置压缩级别，一共9个级别  1-9   ，越高资源消耗越大 越耗时，但压缩效果越好，</span><br><span class="line">    gzip_comp_level 9;</span><br><span class="line">    # 设置是否携带Vary:Accept-Encoding 的响应头</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    # 处理压缩请求的 缓冲区数量和大小</span><br><span class="line">    gzip_buffers 32 64k;</span><br><span class="line">    # 对于不支持压缩功能的客户端请求 不开启压缩机制</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;; # 比如低版本的IE浏览器不支持压缩</span><br><span class="line">    # 设置压缩功能所支持的HTTP最低版本</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    # 设置触发压缩的最小阈值</span><br><span class="line">    gzip_min_length 2k;</span><br><span class="line">    # off/any/expired/no-cache/no-store/private/no_last_modified/no_etag/auth 根据不同配置对后端服务器的响应结果进行压缩</span><br><span class="line">    gzip_proxied any;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>不管是html还是接口响应数据， 压缩后的体积变得非常小了，压缩的效果还是不错的，但是值得注意的是压缩后虽然体积变小了，但是响应的时间会变长，因为压缩&#x2F;解压也需要时间呀！压缩功能似乎有点：用时间换空间的感觉！，当然压缩级别可以调的，你可以选择较低级别的压缩，这样既能实现压缩功能使得数据包体积降下来，同时压缩时间也会缩短是比较折中的一种方案。</p>
<h1 id="完整nginx-conf文件"><a href="#完整nginx-conf文件" class="headerlink" title="完整nginx.conf文件"></a>完整nginx.conf文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  auto;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log notice;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # log_format  debug  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">    #</span><br><span class="line">    log_format  debug  &#x27; $remote_user [$time_local]  $http_x_Forwarded_for $remote_addr  $request &#x27;  </span><br><span class="line">                      &#x27;$http_x_forwarded_for &#x27;  </span><br><span class="line">                      &#x27;$upstream_addr &#x27;  </span><br><span class="line">                      &#x27;ups_resp_time: $upstream_response_time &#x27;  </span><br><span class="line">                      &#x27;request_time: $request_time&#x27;; </span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  debug;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream mybackendserver &#123;</span><br><span class="line">        server 172.30.128.64:8081 fail_timeout=60s max_fails=3; # 60秒内 如果请求某一个应用失败3次，则认为该应用宕机 时间到后再有请求进来继续尝试连接宕机应用且仅尝试 1 次，如果还是失败，则继续等待 60 秒...以此循环，直到恢复</span><br><span class="line">        server 172.30.128.64:8082;</span><br><span class="line">        server 172.30.128.64:8083 backup; # 设置8083位备机</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     # 开启/关闭 压缩机制</span><br><span class="line">    gzip on;</span><br><span class="line">    # 根据文件类型选择 是否开启压缩机制</span><br><span class="line">    gzip_types text/plain application/javascript text/css application/xml text/javascript image/jpeg image/jpg image/gif image/png  application/json;</span><br><span class="line">    # 设置压缩级别，越高资源消耗越大越耗时，但压缩效果越好</span><br><span class="line">    gzip_comp_level 9;</span><br><span class="line">    # 设置是否携带Vary:Accept-Encoding 的响应头</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    # 处理压缩请求的 缓冲区数量和大小</span><br><span class="line">    gzip_buffers 32 64k;</span><br><span class="line">    # 对于不支持压缩功能的客户端请求 不开启压缩机制</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;; # 比如低版本的IE浏览器不支持压缩</span><br><span class="line">    # 设置压缩功能所支持的HTTP最低版本</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    # 设置触发压缩的最小阈值</span><br><span class="line">    gzip_min_length 2k;</span><br><span class="line">    # off/any/expired/no-cache/no-store/private/no_last_modified/no_etag/auth 根据不同配置对后端服务器的响应结果进行压缩</span><br><span class="line">    gzip_proxied any;</span><br><span class="line"></span><br><span class="line">    # 指定缓存存放目录为/usr/local/nginx/test/nginx_cache_storage，并设置缓存名称为mycache，大小为64m， 1天未被访问过的缓存将自动清除，磁盘中缓存的最大容量为1gb</span><br><span class="line">    proxy_cache_path /usr/local/nginx/test/nginx_cache_storage levels=1:2 keys_zone=mycache:64m inactive=1d max_size=1g;</span><br><span class="line">    # 对请求速率限流</span><br><span class="line">    #limit_req_zone $binary_remote_addr zone=myRateLimit:10m rate=5r/s;</span><br><span class="line">    # 对请求连接数限流</span><br><span class="line">    limit_conn_zone $binary_remote_addr zone=myConnLimit:10m; </span><br><span class="line">    </span><br><span class="line">    # --------------------HTTP 演示 配置---------------------</span><br><span class="line">    server &#123;</span><br><span class="line">      listen 80 default;</span><br><span class="line">      charset utf-8;</span><br><span class="line">      server_name www.hzznb-xzll.xyz hzznb-xzll.xyz;</span><br><span class="line"></span><br><span class="line">      #location /static/ &#123;</span><br><span class="line">      #    root /usr/local/nginx/test;  # /usr/local/nginx/test/static/xxx.jpg</span><br><span class="line">      #&#125;</span><br><span class="line"></span><br><span class="line">      location /static &#123; # 注意一般 alias的 url都不带后边的/ </span><br><span class="line">          alias /usr/local/nginx/test/; # 使用alias时  这里的目录最后边一定要加/ 否则就404</span><br><span class="line">      &#125;</span><br><span class="line">      # 测试autoindex效果</span><br><span class="line">      location /book/ &#123;</span><br><span class="line">          root /usr/local/nginx/test;</span><br><span class="line">          autoindex on; # 打开 autoindex，，可选参数有 on | off</span><br><span class="line">          autoindex_format html; # 以html的方式进行格式化，可选参数有 html | json | xml</span><br><span class="line">          autoindex_exact_size on; # 修改为off，会以KB、MB、GB显示文件大小，默认为on以bytes显示出⽂件的确切⼤⼩</span><br><span class="line">          autoindex_localtime off; # 显示⽂件时间 GMT格式</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      # 临时重定向</span><br><span class="line">      location /temp_redir &#123;</span><br><span class="line">          rewrite ^/(.*) https://www.baidu.com redirect;</span><br><span class="line">      &#125;</span><br><span class="line">      # 永久重定向</span><br><span class="line">      location /forever_redir &#123;</span><br><span class="line">          </span><br><span class="line">          rewrite ^/(.*) https://www.baidu.com permanent;</span><br><span class="line">      &#125;</span><br><span class="line">      # rewrite last规则测试</span><br><span class="line">      location /1 &#123;</span><br><span class="line">        rewrite /1/(.*) /2/$1 last;</span><br><span class="line">      &#125;</span><br><span class="line">      location /2 &#123;</span><br><span class="line">        rewrite /2/(.*) /3/$1 last;</span><br><span class="line">      &#125;</span><br><span class="line">      location /3 &#123;</span><br><span class="line">        alias  &#x27;/usr/local/nginx/test/static/&#x27;;</span><br><span class="line">        index location_last_test.html; </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # --------------------HTTP配置---------------------</span><br><span class="line">    server &#123;</span><br><span class="line">      listen 80;</span><br><span class="line">      charset utf-8;</span><br><span class="line">      #server_name www.xxxadminsystem.com;</span><br><span class="line">      server_name www.hzznbc-xzll.xyz hzznbc-xzll.xyz;</span><br><span class="line">      # 重定向，会显示跳转的地址server_name,如果访问的地址没有匹配会默认使用第一个，即www.likeong.icu</span><br><span class="line">      return 301 https://$server_name$request_uri;</span><br><span class="line"></span><br><span class="line">        # # 指定 username 参数中只要有字母 就不走nginx缓存  </span><br><span class="line">        # if ($arg_username ~ [a-z]) &#123;</span><br><span class="line">        #     set $cache_name &quot;no cache&quot;;</span><br><span class="line">        # &#125;</span><br><span class="line">        # # 前端页面资源</span><br><span class="line">        # location  /page &#123;</span><br><span class="line">        #   alias  &#x27;/usr/local/nginx/test/static/&#x27;;</span><br><span class="line">        #   index index_page.html; </span><br><span class="line"></span><br><span class="line">        #   allow all;</span><br><span class="line">        # &#125;</span><br><span class="line">        # # 后端服务</span><br><span class="line">        # location  /interface &#123;</span><br><span class="line">        #   proxy_pass http://mybackendserver/;</span><br><span class="line">        #   # 使用名为 mycache 的缓存空间</span><br><span class="line">        #   proxy_cache mycache;</span><br><span class="line">        #   # 对于200 206 状态码的数据缓存2分钟</span><br><span class="line">        #   proxy_cache_valid 200 206 1m;</span><br><span class="line">        #   # 定义生成缓存键的规则（请求的url+参数作为缓存key）</span><br><span class="line">        #   proxy_cache_key $host$uri$is_args$args;</span><br><span class="line">        #   # 资源至少被重复访问2次后再加入缓存</span><br><span class="line">        #   proxy_cache_min_uses 3;</span><br><span class="line">        #   # 出现重复请求时，只让其中一个去后端读数据，其他的从缓存中读取</span><br><span class="line">        #   proxy_cache_lock on;</span><br><span class="line">        #   # 上面的锁 超时时间为4s，超过4s未获取数据，其他请求直接去后端</span><br><span class="line">        #   proxy_cache_lock_timeout 4s;</span><br><span class="line">        #   # 对于请求参数中有字母的 不走nginx缓存</span><br><span class="line">        #   proxy_no_cache $cache_name; # 判断该变量是否有值，如果有值则不进行缓存，没有值则进行缓存</span><br><span class="line">        #   # 在响应头中添加一个缓存是否命中的状态（便于调试）</span><br><span class="line">        #   add_header Cache-status $upstream_cache_status;</span><br><span class="line">          </span><br><span class="line">        #   limit_conn myConnLimit 12;</span><br><span class="line"></span><br><span class="line">        # limit_req zone=myRateLimit burst=5  nodelay;</span><br><span class="line">        # limit_req_status 520;</span><br><span class="line">        # limit_req_log_level info;</span><br><span class="line">        #&#125;  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # --------------------HTTPS 配置---------------------</span><br><span class="line">    server &#123;</span><br><span class="line">        #SSL 默认访问端口号为 443</span><br><span class="line">        listen 443 ssl; </span><br><span class="line">        #填写绑定证书的域名 </span><br><span class="line">        server_name www.hzznb-xzll.xyz hzznb-xzll.xyz; </span><br><span class="line">        #请填写证书文件的相对路径或绝对路径</span><br><span class="line">        ssl_certificate /usr/local/nginx/certificate/hzznb-xzll.xyz_bundle.crt; </span><br><span class="line">        #请填写私钥文件的相对路径或绝对路径</span><br><span class="line">        ssl_certificate_key /usr/local/nginx/certificate/hzznb-xzll.xyz.key; </span><br><span class="line">        #停止通信时，加密会话的有效期，在该时间段内不需要重新交换密钥</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        #服务器支持的TLS版本</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; </span><br><span class="line">        #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; </span><br><span class="line">        #开启由服务器决定采用的密码套件</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        </span><br><span class="line">        # 指定 username 参数中只要有字母 就不走nginx缓存  </span><br><span class="line">        if ($arg_username ~ [a-z]) &#123;</span><br><span class="line">            set $cache_name &quot;no cache&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        # 前端页面资源</span><br><span class="line">        location  /page &#123;</span><br><span class="line">          alias  &#x27;/usr/local/nginx/test/static/&#x27;;</span><br><span class="line">          index index_page.html; </span><br><span class="line"></span><br><span class="line">          allow all;</span><br><span class="line">        &#125;</span><br><span class="line">        # 后端服务</span><br><span class="line">        location  /interface &#123;</span><br><span class="line">          proxy_pass http://mybackendserver/;</span><br><span class="line"></span><br><span class="line">          # 指定哪些错误状态才执行 重试</span><br><span class="line">          proxy_next_upstream error timeout http_500 http_502 http_503 http_504 http_404;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          # 使用名为 mycache 的缓存空间</span><br><span class="line">          proxy_cache mycache;</span><br><span class="line">          # 对于200 206 状态码的数据缓存2分钟</span><br><span class="line">          proxy_cache_valid 200 206 1m;</span><br><span class="line">          # 定义生成缓存键的规则（请求的url+参数作为缓存key）</span><br><span class="line">          proxy_cache_key $host$uri$is_args$args;</span><br><span class="line">          # 资源至少被重复访问2次后再加入缓存</span><br><span class="line">          proxy_cache_min_uses 3;</span><br><span class="line">          # 出现重复请求时，只让其中一个去后端读数据，其他的从缓存中读取</span><br><span class="line">          proxy_cache_lock on;</span><br><span class="line">          # 上面的锁 超时时间为4s，超过4s未获取数据，其他请求直接去后端</span><br><span class="line">          proxy_cache_lock_timeout 4s;</span><br><span class="line">          # 对于请求参数中有字母的 不走nginx缓存</span><br><span class="line">          proxy_no_cache $cache_name; # 判断该变量是否有值，如果有值则不进行缓存，没有值则进行缓存</span><br><span class="line">          # 在响应头中添加一个缓存是否命中的状态（便于调试）</span><br><span class="line">          add_header Cache-status $upstream_cache_status;</span><br><span class="line">          </span><br><span class="line">          limit_conn myConnLimit 12;</span><br><span class="line"></span><br><span class="line">        # limit_req zone=myRateLimit burst=5  nodelay;</span><br><span class="line">        # limit_req_status 520;</span><br><span class="line">        # limit_req_log_level info;</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        # 后端服务</span><br><span class="line">        location  /interface2 &#123;</span><br><span class="line">          proxy_pass http://mybackendserver;</span><br><span class="line">          # 使用名为 mycache 的缓存空间</span><br><span class="line">          proxy_cache mycache;</span><br><span class="line">          # 对于200 206 状态码的数据缓存2分钟</span><br><span class="line">          proxy_cache_valid 200 206 1m;</span><br><span class="line">          # 定义生成缓存键的规则（请求的url+参数作为缓存key）</span><br><span class="line">          proxy_cache_key $host$uri$is_args$args;</span><br><span class="line">          # 资源至少被重复访问2次后再加入缓存</span><br><span class="line">          proxy_cache_min_uses 3;</span><br><span class="line">          # 出现重复请求时，只让其中一个去后端读数据，其他的从缓存中读取</span><br><span class="line">          proxy_cache_lock on;</span><br><span class="line">          # 上面的锁 超时时间为4s，超过4s未获取数据，其他请求直接去后端</span><br><span class="line">          proxy_cache_lock_timeout 4s;</span><br><span class="line">          # 对于请求参数中有字母的 不走nginx缓存</span><br><span class="line">          proxy_no_cache $cache_name; # 判断该变量是否有值，如果有值则不进行缓存，没有值则进行缓存</span><br><span class="line">          # 在响应头中添加一个缓存是否命中的状态（便于调试）</span><br><span class="line">          add_header Cache-status $upstream_cache_status;</span><br><span class="line">          </span><br><span class="line">          limit_conn myConnLimit 12;</span><br><span class="line"></span><br><span class="line">        # limit_req zone=myRateLimit burst=5  nodelay;</span><br><span class="line">        # limit_req_status 520;</span><br><span class="line">        # limit_req_log_level info;</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7306041273822527514#heading-67">https://juejin.cn/post/7306041273822527514#heading-67</a><br><a target="_blank" rel="noopener" href="https://openresty.org/download/agentzh-nginx-tutorials-zhcn.html#00-Foreword02">https://openresty.org/download/agentzh-nginx-tutorials-zhcn.html#00-Foreword02</a></p>
<p><a target="_blank" rel="noopener" href="https://openresty.org/cn/">https://openresty.org/cn/</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7166923395802595336?searchId=2024052312322984A6B385B1DDE00B11FC#heading-13">https://juejin.cn/post/7166923395802595336?searchId=2024052312322984A6B385B1DDE00B11FC#heading-13</a></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/05/23/sundries/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E7%8E%AF%E8%A7%86/" rel="prev" title="正则表达式-环视">
                  <i class="fa fa-chevron-left"></i> 正则表达式-环视
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
